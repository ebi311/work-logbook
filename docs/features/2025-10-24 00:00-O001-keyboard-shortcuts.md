# O-001: キーボードショートカット機能

## 概要

作業記録アプリの操作性を向上させるため、主要な操作をキーボードショートカットで実行できるようにする。

## 目的

- マウス操作を減らし、キーボードのみで作業記録を完結できるようにする
- 作業の開始・終了をより素早く記録できるようにする
- エンジニアにとって直感的なショートカットキーで操作性を向上させる

## 機能要件

### 1. 作業開始/終了のショートカット

**ショートカットキー**: `Cmd/Ctrl + S`

- **動作**:
  - 現在作業中でない場合: 作業を開始する
  - 現在作業中の場合: 作業を終了する
- **フィードバック**:
  - 操作成功時に成功メッセージを表示
  - エラー時にエラーメッセージを表示

### 2. 最新の作業編集のショートカット

**ショートカットキー**: `Cmd/Ctrl + E`

- **動作**:
  - 最新の作業記録の編集画面を開く
  - （MVP段階では未実装の場合、将来の拡張として定義）
- **制約**:
  - 作業記録が存在しない場合は何もしない

### 3. ショートカットヘルプの表示

**ショートカットキー**: `Cmd/Ctrl + /` または `?`

- **動作**:
  - 利用可能なショートカットの一覧をモーダルまたはツールチップで表示
- **内容**:
  - キーの組み合わせと対応する操作の説明

## UI/UX要件

### ビジュアルフィードバック

- ショートカット実行時、対応するボタンに一時的なハイライト効果を表示
- 成功/エラーメッセージは既存のMessageAlertコンポーネントを使用

### アクセシビリティ

- ショートカットキーはページ内のどこからでも実行可能
- ただし、入力フィールドにフォーカスがある場合は除外
- スクリーンリーダー利用者のため、ショートカット情報をaria-labelで提供

### プラットフォーム対応

- **macOS**: `Cmd + キー`
- **Windows/Linux**: `Ctrl + キー`
- 実装では `event.metaKey || event.ctrlKey` で判定

## 技術仕様

### 実装方針

1. **グローバルキーボードイベントリスナー**
   - ページレベルで `keydown` イベントをリッスン
   - 適切なショートカットキーの組み合わせを検出

2. **イベントハンドリング**
   - 既存のフォームアクションを活用
   - ショートカットから既存のボタンクリック処理を呼び出す

3. **状態管理**
   - 現在の作業状態（active/inactive）に応じて適切な処理を実行
   - 既存のstate管理と連携

### コンポーネント構成

```
src/routes/
  +page.svelte (メインページ - ショートカットリスナーを追加)
  _components/
    KeyboardShortcutHelp/ (新規作成)
      KeyboardShortcutHelp.svelte
      KeyboardShortcutHelp.spec.ts
```

### イベント処理フロー

```
1. ユーザーがショートカットキーを押下
   ↓
2. keydownイベントハンドラーが発火
   ↓
3. 修飾キー + キーの組み合わせを判定
   ↓
4. 現在の状態を確認（作業中 or 未作業）
   ↓
5. 適切なアクションを実行（start/stop）
   ↓
6. ビジュアルフィードバックを表示
```

## 非機能要件

### パフォーマンス

- キーボードイベントハンドラーはデバウンス不要（単発のアクション）
- イベントリスナーは1つのみ設定（メモリ効率）

### セキュリティ

- ショートカット実行時も通常のフォーム送信と同じ認証・バリデーションを通過させる

## テスト要件

### ユニットテスト

- [ ] `Cmd/Ctrl + S` で作業開始できる
- [ ] 作業中に `Cmd/Ctrl + S` で作業終了できる
- [ ] 入力フィールドフォーカス時はショートカットが無効化される
- [ ] macOS/Windows両方の修飾キーで動作する

### E2Eテスト

- [ ] キーボード操作のみで作業開始から終了までできる
- [ ] ショートカット実行後、UIが適切に更新される

## 制約事項

### MVP範囲外

以下の機能はMVPの範囲外とし、将来のイテレーションで実装を検討:

- 作業編集のショートカット（`Cmd/Ctrl + E`）- 編集機能自体が未実装のため
- カスタマイズ可能なショートカット設定
- グローバルショートカット（ブラウザ外からのトリガー）

### ブラウザ互換性

- モダンブラウザ（Chrome, Firefox, Safari, Edge）での動作を保証
- `event.key` APIを使用（IE11非対応だが問題なし）

## 参考資料

- [MDN - KeyboardEvent](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent)
- [WAI-ARIA - Keyboard Interface](https://www.w3.org/WAI/ARIA/apg/practices/keyboard-interface/)
